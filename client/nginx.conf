server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Disable Gzip (Outer Nginx handles it)
    gzip off;
    # Disable Server Tokens
    server_tokens off;

    # --- 1. Long-Term Caching for Assets ---
    # Vite builds hashed files (e.g., assets/index.a8b3.js).
    # If the file changes, the hash changes, so we can cache the old one forever.
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, max-age=31536000, immutable";
        access_log off; # Turn off logging for assets to save I/O
    }

    # --- 2. SPA Routing & Index Caching ---
    # Any route not found (like /dashboard) falls back to index.html
    location / {
        try_files $uri $uri/ /index.html;

        # CRITICAL: Never cache index.html.
        # This ensures users always get the latest reference to your new assets.
        add_header Cache-Control "no-store, no-cache, must-revalidate";
    }
}